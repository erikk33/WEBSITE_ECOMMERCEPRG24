<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
</head>

<body>
    <div id="app" class="bg-white">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <!-- ... Your Navbar code ... -->
        </nav>

        <div class="container mx-auto mt-5">
            <div class="grid grid-cols-3 gap-4">
                <!-- Product showcase -->
                <div class="col-span-2">
                    <h3 class="text-2xl mb-3">Produk yang Dibeli</h3>
                    <ul id="selected-products" class="mb-4">
                        <!-- List of selected products will be displayed here -->
                    </ul>
                    <button class="btn btn-primary" @click="addToCart">Tambah Produk ke Keranjang</button>
                    <a href="index.html"
                class="fixed bottom-4 right-4 p-3 bg-blue-500 rounded-full shadow-lg hover:bg-blue-600 transition duration-300">
                <i class="fas fa-arrow-up text-white"></i>
            </a>
                </div>
                <!-- New section to display latest data -->
                <div class="col-span-1">
                    <h3 class="text-2xl mb-3">Data Terbaru</h3>
                    <ul id="latest-data">
                        <!-- List of latest data will be displayed here -->
                    </ul>
                </div>
                <!-- Shopping cart -->
                <div class="cart hide">
                    <h3 class="cart-title">
                        <img src="—Pngtree—fast shopping cart icon design_5537563.png" alt="Logo"
                            style="width: 20px; height: 20px;">
                    </h3>
                    <ul id="cart-items">
                        <!-- List of cart items will be displayed here -->
                    </ul>
                    <div class="total-price">
                        <span>Total Harga: <span id="totalPrice">RP0</span></span>
                    </div>
                    <div class="payment-methods">
                        <h4 class="text-lg mb-2">Pilih Metode Pembayaran:</h4>
                        <label class="block mb-1">
                            <input type="radio" name="paymentMethod" value="dana" v-model="selectedPaymentMethod">
                            Dana
                        </label>
                        <label class="block mb-1">
                            <input type="radio" name="paymentMethod" value="shopee" v-model="selectedPaymentMethod">
                            Shopee Pay
                        </label>
                        <label class="block mb-1">
                            <input type="radio" name="paymentMethod" value="gopay" v-model="selectedPaymentMethod">
                            GoPay
                        </label>
                        <label class="block mb-1">
                            <input type="radio" name="paymentMethod" value="transfer" v-model="selectedPaymentMethod">
                            Transfer ke Bank Indonesia
                        </label>
                    </div>
                    <button class="btn btn-primary btn-block mt-3" @click="checkout">Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                cartItems: [],
                selectedPaymentMethod: '' // To store the selected payment method
            },
            methods: {
                async fetchLatestData() {
                    const apiUrl = "https://64b3fb360efb99d862689dda.mockapi.io/Faq/V1/keranjang"; // Replace with your API URL
                    try {
                        const response = await fetch(apiUrl);
                        const data = await response.json();

                        const latestData = Object.values(data);

                        this.displayLatestData(latestData);
                    } catch (error) {
                        console.error(error);
                    }
                },
                displayLatestData(latestData) {
                    const latestDataElement = document.getElementById("latest-data");
                    latestDataElement.innerHTML = "";

                    latestData.forEach((item, index) => {
                        const li = document.createElement('li');
                        li.className = 'latest-data-item';
                        li.innerHTML = `
                        <span>${item.product} - RP${item.price.toLocaleString()}</span>
                    `;
                        latestDataElement.appendChild(li);
                    });
                },
                async fetchProducts() {
                    const apiUrl = "https://your-mock-api-url"; // Replace with your API URL
                    try {
                        const response = await fetch(apiUrl);
                        const products = await response.json();

                        this.displayProducts(products);
                    } catch (error) {
                        console.error(error);
                    }
                },
                displayProducts(products) {
                    const selectedProductsElement = document.getElementById("selected-products");
                    selectedProductsElement.innerHTML = "";

                    products.forEach((item, index) => {
                        const li = document.createElement('li');
                        li.className = 'product';
                        li.innerHTML = `
                        <span>${item.product} - RP${item.price.toLocaleString()}</span>
                        <button class="btn btn-sm btn-outline-primary mt-1" @click="addToCart(${item.id})">Tambahkan ke Keranjang</button>
                    `;
                        selectedProductsElement.appendChild(li);
                    });
                },
                async fetchCartData() {
                    const apiUrl = "https://your-mock-api-url"; // Replace with your API URL
                    try {
                        const response = await fetch(apiUrl);
                        this.cartItems = await response.json();

                        this.renderCart();
                    } catch (error) {
                        console.error(error);
                    }
                },
                addToCart(productId) {
                    const selectedProduct = this.cartItems.find(item => item.product_id === productId);
                    if (!selectedProduct) {
                        const product = {
                            product_id: productId,
                            product: `Product ${productId}`, // You can modify this based on your mock API response
                            price: 10000 * productId // You can modify this based on your mock API response
                        };
                        this.cartItems.push(product);
                        this.renderCart();
                    }
                },
                removeFromCart(index) {
                    this.cartItems.splice(index, 1);
                    this.renderCart();
                },
                renderCart() {
                    const cartItemsElement = document.getElementById('cart-items');
                    const totalPriceElement = document.getElementById('totalPrice');
                    let totalPrice = this.calculateTotalPrice(this.cartItems);

                    cartItemsElement.innerHTML = '';

                    this.cartItems.forEach((item, index) => {
                        const li = document.createElement('li');
                        li.className = 'cart-item';
                        li.innerHTML = `
                        <span>${item.product} - RP${item.price.toLocaleString()}</span>
                        <i class="fas fa-trash" @click="removeFromCart(${index})"></i>
                    `;
                        cartItemsElement.appendChild(li);
                    });

                    totalPriceElement.textContent = `Total Harga: RP${totalPrice.toLocaleString()}`;

                    const cart = document.querySelector('.cart');
                    if (this.cartItems.length > 0) {
                        cart.classList.remove('hide');
                    } else {
                        cart.classList.add('hide');
                    }
                },
                calculateTotalPrice(cartItems) {
                    return cartItems.reduce((total, item) => total + item.price, 0);
                },
                checkout() {
                    if (!this.selectedPaymentMethod) {
                        alert('Pilih salah satu metode pembayaran.');
                        return;
                    }

                    const phoneNumber = "0895331309082";
                    const paymentInfo = `Metode Pembayaran: ${this.selectedPaymentMethod}\nTotal Harga: RP${this.calculateTotalPrice(this.cartItems).toLocaleString()}`;
                    const message = `Saya ingin membeli barang dan membayarnya melalui metode pembayaran yang sebelumnya dipilih disini:\n\n${paymentInfo}`;

                    const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
                    window.location.href = whatsappUrl;

                    this.cartItems.length = 0;
                    this.renderCart();
                }
            },
            created() {
                console.log("DOM Loaded");
                this.fetchProducts();
                this.fetchCartData();
                this.fetchLatestData();
            }
        });
    </script>
</body>

</html>
